<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8" />
	<title>EValuator - EV Bulk Charging Planner: Stage 1</title>
	<link rel="StyleSheet" href="resources/leaflet.css" type="text/css" />
	<link rel="StyleSheet" href="resources/style.css" type="text/css" />
	<script type="text/javascript" src="resources/leaflet.js"></script>
	<script type="text/javascript" src="resources/leaflet.markercluster.js"></script>
	<script type="text/javascript" src="resources/oi.stepped.js"></script>
	<script type="text/javascript" src="resources/ranking.js"></script>
  <!-- Add issuer script -->
  <script defer src="//cdn.jsdelivr.net/gh/open-innovations/issuer@0.2.0/lib/issuer.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/open-innovations/issuer@0.2.0/lib/issuer.css"/>  
</head>
<body class="b6-bg">

	<div class="padded warning">Warning: this is a prototype tool so results should not necessarily be trusted.</div>
	<div id="messages"></div>

	<header class="site-header">
		<div class="holder">
			<a href="/" class="site-title">EValuator - EV Bulk Charging Planner</a>
			<input id="menu-state" class="menu-state" type="checkbox">
			<label class="menu-toggle" for="menu-state">
				<div class="menu-burger"><i></i><i></i><i></i></div>
			</label>
			<nav class="menu-items">
				<a href="/">Start</a>
				<a href="/ranking.html">Stage 1 - Rank</a>
				<a href="/model.html">Stage 2 - Model</a>
			</nav>
		</div>
	</header>

	<div id="app" class="doublepadded">

		<div class="bg"></div>
		<div class="holder">
			<h1>Stage 1: Ranking</h1>
			
			<form id="area-typeahead">
				<label for="typeahead">Search for an area:</label>
				<input type="text" id="area" value="" placeholder="e.g. Leeds" autocomplete=“off”>
			</form>
			
			<section id="map" class="screen">
				<div id="location"><div id='tooltip'></div></div>
			</section>
			<div id="scalebar"><div class="bar" style="background: rgb(34, 84, 244,0.1); background: -moz-linear-gradient(left, rgb(34, 84, 244,0.1) 0%, rgb(34, 84, 244,0.8) 100%);background: -webkit-linear-gradient(left, rgb(34, 84, 244,0.1) 0%, rgb(34, 84, 244,0.8) 100%);background: linear-gradient(to right, rgb(34, 84, 244,0.1) 0%, rgb(34, 84, 244,0.8) 100%);;position:relative;"><div class="bar-inner" style="border: 1px solid #ddd;height:1em;border-top:0;border-right:0;"></div></div><div class="range" style="border-color: #ddd"><span class="lvl min" style="border-left: 1px solid #ddd;padding-left:0.25em;float:left;">0</span><span class="lvl max" style="border-right: 1px solid #ddd;padding-right:0.25em;float:right;">1</span><div style="clear:both"></div></div></div>

			<ul class="grid tabs" role="tablist">
				<li role="presentation" id="tab-weightings"><a role="tab" href="#weightings" title="Switch to weightings" class="active" aria-selected="true"><h2>Weightings<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="bi bi-sliders" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3h9.05zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8h2.05zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1h9.05z"/></svg></h2></a></li>
				<li role="presentation" id="tab-rankings"><a role="tab" href="#rankings" title="Switch to rankings of MSOAs" aria-selected="false" class=""><h2>Ranked MSOAs<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="bi bi-list-ol" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5z"/><path d="M1.713 11.865v-.474H2c.217 0 .363-.137.363-.317 0-.185-.158-.31-.361-.31-.223 0-.367.152-.373.31h-.59c.016-.467.373-.787.986-.787.588-.002.954.291.957.703a.595.595 0 0 1-.492.594v.033a.615.615 0 0 1 .569.631c.003.533-.502.8-1.051.8-.656 0-1-.37-1.008-.794h.582c.008.178.186.306.422.309.254 0 .424-.145.422-.35-.002-.195-.155-.348-.414-.348h-.3zm-.004-4.699h-.604v-.035c0-.408.295-.844.958-.844.583 0 .96.326.96.756 0 .389-.257.617-.476.848l-.537.572v.03h1.054V9H1.143v-.395l.957-.99c.138-.142.293-.304.293-.508 0-.18-.147-.32-.342-.32a.33.33 0 0 0-.342.338v.041zM2.564 5h-.635V2.924h-.031l-.598.42v-.567l.629-.443h.635V5z"/></svg></h2></a></li>
			</ul>
			<div class="panes" role="tabpanel">
				<section id="weightings">
					<p>Adjust the sliders to increase or decrease the effect that a data layer has on the overall ranking. The "inverted" toggle means that lower values in the data layer will a bigger impact on ranking e.g. if the transport accessibility layer is inverted, areas with lowest transport accessibility will score more highly for that data layer.</p>
					<p>The presets below have pre-defined settings to adjust the form below.</p>
					<div id="weights"></div>
				</section>

				<section id="rankings">
					<p>This area will show the MSOAs in your chosen area ranked by the total score calculated by using the values for the individual factors and the weightings you set for them.</p>
					<div id="ranking">No <a href="#area">area has been chosen</a> so there are no MSOAs to show.</div>
				</section>
			</div>
			
		</div>
	</div>
	
	<footer class="doublepadded">
		<div class="holder">
			<h2>Credits</h2>
			<p>Visualisation &copy; Open Innovations 2022.</p>
			
			<h2>Data sources</h2>

			<ul>
				<li><a href="https://houseofcommonslibrary.github.io/msoanames/">MSOA names</a>: House of Commons Library</li>
				<li><a href="https://geoportal.statistics.gov.uk/datasets/middle-layer-super-output-areas-december-2011-boundaries-ew-bgc">MSOA boundaries</a>: Office for National Statistics licensed under the Open Government Licence v.3.0. Contains OS data © Crown copyright and database right 2021</li>
				<li><a href="https://geoportal.statistics.gov.uk/datasets/ons::output-areas-december-2011-boundaries-ew-bgc-1/about">Output Areas (December 2011) Boundaries EW BGC</a>: ONS</li>
				<li><a href="https://geoportal.statistics.gov.uk/datasets/ons::local-authority-districts-december-2021-gb-bgc/about">Local Authority Districts (December 2021) GB BGC</a>: ONS</li>
				<li><a href="https://geoportal.statistics.gov.uk/datasets/ons::output-area-to-lower-layer-super-output-area-to-middle-layer-super-output-area-to-local-authority-district-december-2020-lookup-in-england-and-wales/about">Output Area to Lower Layer Super Output Area to Middle Layer Super Output Area to Local Authority District (December 2020) Lookup in England and Wales</a>: ONS</li>
				<li><a href="https://geoportal.statistics.gov.uk/documents/local-authority-district-to-combined-authority-december-2021-lookup-in-england-v2/about">Local Authority District to Combined Authority (December 2021) Lookup in England v2</a>: ONS</li>
				<li><a href="https://github.com/odileeds/OpenJourneyTime">MSOA to MSOA journey times</a> - Tom Forth / Open Innovations</li>
				<li><a href="https://download.geofabrik.de/europe/great-britain.html">OpenStreetMap GB extract</a> - Open Street Map</li>
				<li><a href="https://www.gov.uk/government/statistics/electric-vehicle-charging-device-grant-scheme-statistics-october-2021/electric-vehicle-charging-device-grant-scheme-statistics-october-2021">Electric Vehicle Homecharge Scheme</a> - EVHS</li>
				<li><a href="https://chargepoints.dft.gov.uk/">Chargepoint locations</a> - National Chargepoint Registry</li>
				<li>Grid capacity (from <a href="https://github.com/odileeds/northern-powergrid/blob/master/2021-DFES/data/scenarios/primaries/PeakUtilisation-SP.csv">peak utilisation</a> and <a href="https://github.com/odileeds/northern-powergrid/blob/master/2021-DFES/data/scenarios/primaries/PeakDemand-SP.csv">peak demand</a> in 2030 under Steady Progression) - Northern Powergrid</li>
				<li><a href="https://www.digital-land.info/dataset/brownfield-land">Brownfield land</a> - DLUHC (OGL v3)</li>
				<li><a href="https://icons.getbootstrap.com/icons/list-ol/">Icons</a> - Bootstrap (MIT licence)</li>
			</ul>
		</div>
	</footer>

  <aside id="issuer-root"></aside>
  <script>
    // Attach the issue form component passing the required config
    addEventListener('DOMContentLoaded', function () {
      oi.issuer({
        target: document.querySelector('#issuer-root'),
        endpoint: 'https://8098cec81e241af408f7acc6b778cfd4.m.pipedream.net',
        owner: 'open-innovations',
        repo: 'EValuator',
        heading: 'Give us feedback on this prototype',
      });
    });
  </script>

	<script>
	OI.ready(function(){
		app = new OI.EValuator({'map':document.getElementById('map'),'ranking':document.getElementById('ranking'),'weights':document.getElementById('weights')});


		// Make tabbed interface
		function Tabbed(opt){
			if(!opt) opt = {};
			if(!opt.tabs){
				console.error('No tabs provided');
				return this;
			}
			var tabs = opt.tabs;
			var panes = [];
			var _obj = this;
			for(var t = 0; t < tabs.length; t++){
				panes[t] = document.getElementById(tabs[t].getAttribute('href').substring(1,));
				tabs[t].setAttribute('data',t);
				tabs[t].addEventListener('click',function(e){
					e.preventDefault();
					el = e.target;
					if(el.tagName != "A") el = el.closest('a');
					var i = parseInt(el.getAttribute('data'));
					_obj.set(i);
				});
			}
			this.set = function(i){
				for(var p = 0; p < panes.length; p++){
					if(p==i){
						panes[p].style.display = '';
						tabs[p].setAttribute('aria-selected',true);
					}else{
						panes[p].style.display = 'none';
						tabs[p].setAttribute('aria-selected',false);
					}
				}
			}
			this.set(0);
			return this;
		}
		
		var tabbed = new Tabbed({'tabs': document.querySelectorAll('.grid.tabs a')});

		// Define the steps
		app.steps.add(document.getElementById('area'),'<h3>Step 1</h3><p>Choose a Local Authority or Combined Authority to focus on.</p>','bottom').open();
		app.steps.add(document.getElementById('tab-weightings'),'<h3>Step 2</h3><p>Next, adjust the weightings to prioritise the MSOAs within the area. You will be able to see the results in the "Ranked MSOAs" tab.</p>','top');

	})
	</script>
</body>
</html>
